# Многозадачность
## TL;DR;
Многозадачность - это способность операционной системы выполнять несколько задач одновременно.
Контекст - это состояние задачи в определенный момент времени.

## Инструкции процессора
Процессор выполняет инструкции, переданные ему операционной системой.
Современные процессоры могут выполнять несколько инструкций одновременно, за счет использования нескольких ядер.
Каждое ядро процессора может выполнять более одной инструкции одновременно, если они используют разные ресурсы.
Например, чтение из памяти и запись в регистр. (Внимательно: чтение и запись в память не могут выполняться одновременно).
Очередь инструкций принято называть потоком или нитью (Thread). Обычно одно ядро современного процессора имеет 2 потока.
Операционная система управляет передачей инструкций процессору таким образом, чтобы обеспечить максимальную производительность.
Важным аспектом является то что управление передачей инструкций процессору не является многозадачностью. 
Это просто управление ресурсами процессора, которое предоставляет возможность к многозадачности. 
Многозадачность - это способность операционной системы, а не процессора. Поскольку процессор является лишь одним из
ресурсов, которыми операционная система управляет, многозадачность возможна на однопоточных процессорах, хотя и менее эффективна.   

## Однопоточная многозадачность
Операционная система выполняет задачи пошагово. Какой бы сложной ни была задача, она состоит 
из множества простых шагов: Математические операции, чтение из памяти, запись в память, чтение из диска, запись на диск и т.д.
Операционная система выполняет эти шаги поочередно, переключаясь между задачами. Делается это для того, чтобы
обеспечить максимальную эффективность использования системных ресурсов. Пока занят один ресурс, другие могут быть использованы
Если представить очень грубо, то операционная система - это встречающий, который определяет 
кто именно будет решать задачу конкретного шага и если исполнитель свободен то направляет его на выполнение задачи а если нет то
переходит к следующей задаче, создавая тем разветвление очереди задач по исполнителям. Таким образом, 
даже на однопоточных процессорах операционная система может обеспечить многозадачность.

Многопоточный процессор позволяет операционной системе оптимизировать процесс переключения между задачами, через предподготовку
операций для одного ресурса между разными задачами. Таким образом шаги одной задачи могут выполняться в разных потоках,
однако их выполнение будет происходить гарантированно последовательно. Однако шаги разных задач могут выполняться в
произвольном порядке, поскольку зависят не только от времени, но и от состояния других задач использующих тот же ресурс.

## Контекст
Контекст - это состояние задачи в определенный момент исполнения. Контекст задачи включает в себя значения регистров процессора,
указатель на текущую инструкцию, указатель на стек и другие данные, необходимые для продолжения выполнения задачи.
Переключение контекста называется прерыванием. В момент прерывания операционная система передает управление специальному
сервису, который сохраняет контекст текущей задачи и загружает контекст следующей задачи. После этого управление передается
следующей задаче.

Переключение бывает добровольным (Voluntary): когда задача завершает свою работу или знает что текущий шаг 
выполняет неблокирующую операцию, (например, http запрос) и принудительным (Non voluntary): когда задача выполняется
слишком долго или выполняет блокирующую операцию (например, чтение из диска).

Добровольное переключение контекста дешевле, чем принудительное, поскольку требует меньше времени 
на сохранение и загрузку контекста.
